<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½è—¥å¸« SOAPå°å¹«æ‰‹ (v16.0 - Firebase)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* (æ¨£å¼èˆ‡ v15.4 ç›¸åŒ, ä¿æŒä¸è®Š) */
        body {
            font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
        }
        .spinner {
            border-top-color: transparent;
            width: 1.5rem;
            height: 1.5rem;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .prose pre {
            background-color: #f9fafb;
            color: #1f2937;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
            white-space: pre-wrap;
            font-family: inherit;
            font-size: 0.95rem;
        }
        details summary {
            cursor: pointer;
            font-weight: 600;
            color: #2563eb;
        }
        details summary:hover {
            text-decoration: underline;
        }
        /* v16: Google ç™»å…¥æŒ‰éˆ•æ¨£å¼ */
        .google-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: #ffffff;
            color: #4A5568;
            border: 1px solid #CBD5E0;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            transition: all 0.2s ease-in-out;
        }
        .google-btn:hover {
            background-color: #f7fafc;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .google-btn svg {
            width: 1.25rem;
            height: 1.25rem;
            margin-right: 0.75rem;
        }
        #progressBarContainer {
            display: none;
            width: 100%;
            background-color: #e5e7eb;
            border-radius: 9999px;
            overflow: hidden;
            margin-bottom: 1rem;
        }
        .progress-bar {
            width: 100%;
            height: 0.75rem;
            background-color: #3b82f6;
            border-radius: 9999px;
            animation: indeterminate-progress 2s linear infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-gray-100 min-h-screen text-gray-800">

    <script type="module">
        import { firebaseConfig } from './firebase-config.js'; // <-- ğŸš¨ æ–°å¢é€™ä¸€è¡Œ

    // v16: Firebase SDK æ¨¡çµ„
        const { initializeApp } = await import('...');
    // ... (åº•ä¸‹ç¨‹å¼ç¢¼ä¸è®Š) ...
        // v16: å‹•ä½œ 2 - Firebase è¨­å®š
        // ğŸš¨ğŸš¨ğŸš¨ è«‹å¾æ‚¨çš„ Firebase å°ˆæ¡ˆè¨­å®šä¸­è¤‡è£½è²¼ä¸Šæ‚¨çš„è¨­å®š ğŸš¨ğŸš¨ğŸš¨
        

        // =================================================================
        // D-O-M E-L-E-M-E-N-T-S
        // =================================================================
        
        // v16: Firebase SDK æ¨¡çµ„
        const { initializeApp } = await import('https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js');
        const { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } = await import('https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js');
        const { getFunctions, httpsCallable, connectFunctionsEmulator } = await import('https://www.gstatic.com/firebasejs/9.23.0/firebase-functions.js');

        // v16: ç™»å…¥ç›¸é—œ DOM
        const loginSection = document.getElementById('loginSection');
        const mainContent = document.getElementById('mainContent');
        const signInButton = document.getElementById('signInButton');
        const signOutButton = document.getElementById('signOutButton');
        const authStatus = document.getElementById('authStatus');

        // v16: ä¸»è¦åŠŸèƒ½ DOM
        const generateButton = document.getElementById('generateButton');
        const patientInfoInput = document.getElementById('patientInfo');
        const specialtyFocusSelect = document.getElementById('specialtyFocus');
        const uptodateInfoInput = document.getElementById('uptodateInfo');
        const micromedexInfoInput = document.getElementById('micromedexInfo');
        const openevidenceInfoInput = document.getElementById('openevidenceInfo');
        
        const outputDiv = document.getElementById('output');
        const placeholderDiv = document.getElementById('placeholder');
        const infoBox = document.getElementById('infoBox');
        const sourcesContainer = document.getElementById('sourcesContainer');
        const sourcesList = document.getElementById('sourcesList');
        const clearInputsButton = document.getElementById('clearInputsButton');
        const copyButton = document.getElementById('copyButton');
        const progressBarContainer = document.getElementById('progressBarContainer');
        
        // v16: éŒ¯èª¤ Modal DOM
        const errorModal = document.getElementById('errorModal');
        const errorMessage = document.getElementById('errorMessage');
        const closeModalButton = document.getElementById('closeModalButton');

        // =================================================================
        // F-I-R-E-B-A-S-E I-N-I-T
        // =================================================================

        // åˆå§‹åŒ– Firebase App
        const app = initializeApp(firebaseConfig);
        
        // åˆå§‹åŒ– Firebase æœå‹™
        const auth = getAuth(app);
        const functions = getFunctions(app, 'asia-east1'); // é—œéµï¼šæŒ‡å®šæ‚¨éƒ¨ç½²çš„å€åŸŸï¼
        
        // (é¸å¡«) å¦‚æœæ‚¨æƒ³åœ¨ã€Œæœ¬æ©Ÿã€æ¸¬è©¦ Functions, è«‹å–æ¶ˆè¨»è§£ä¸‹ä¸€è¡Œ
        // connectFunctionsEmulator(functions, "localhost", 5001);

        // å–å¾—æˆ‘å€‘éƒ¨ç½²åœ¨é›²ç«¯çš„ AI å‡½å¼
        const generateSoapNote = httpsCallable(functions, 'generateSoapNote');

        // =================================================================
        // E-R-R-O-R H-A-N-D-L-I-N-G
        // =================================================================
        
        function showError(message) {
            errorMessage.textContent = message || "ç™¼ç”ŸæœªçŸ¥çš„éŒ¯èª¤ã€‚";
            errorModal.classList.remove('hidden');
        }
        closeModalButton.addEventListener('click', () => {
            errorModal.classList.add('hidden');
        });

        // =================================================================
        // A-U-T-H-E-N-T-I-C-A-T-I-O-N
        // =================================================================

        const googleProvider = new GoogleAuthProvider();

        // ç›£è½ç™»å…¥ç‹€æ…‹æ”¹è®Š
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // --- ä½¿ç”¨è€…å·²ç™»å…¥ ---
                authStatus.textContent = `å·²ç™»å…¥ç‚ºï¼š${user.displayName} (${user.email})`;
                authStatus.className = "mt-4 text-green-600 text-sm";
                signInButton.classList.add('hidden');
                signOutButton.classList.remove('hidden');
                
                // é¡¯ç¤ºä¸»è¦å…§å®¹
                loginSection.classList.add('opacity-70'); // ç™»å…¥å€å¡Šè®Šæš—
                mainContent.style.display = 'grid'; // é¡¯ç¤º App

            } else {
                // --- ä½¿ç”¨è€…å·²ç™»å‡º ---
                authStatus.textContent = "ç‹€æ…‹ï¼šå°šæœªç™»å…¥";
                authStatus.className = "mt-4 text-gray-500 text-sm";
                signInButton.classList.remove('hidden');
                signOutButton.classList.add('hidden');
                
                // éš±è—ä¸»è¦å…§å®¹
                loginSection.classList.remove('opacity-70');
                mainContent.style.display = 'none'; // éš±è— App
            }
        });

        // é»æ“Šã€Œç™»å…¥ã€æŒ‰éˆ•
        signInButton.addEventListener('click', async () => {
            try {
                await signInWithPopup(auth, googleProvider);
                // ç™»å…¥æˆåŠŸ, onAuthStateChanged æœƒè‡ªå‹•è™•ç†
            } catch (error) {
                console.error("Google ç™»å…¥å¤±æ•—:", error);
                showError(`ç™»å…¥å¤±æ•—ï¼š${error.message}`);
            }
        });

        // é»æ“Šã€Œç™»å‡ºã€æŒ‰éˆ•
        signOutButton.addEventListener('click', async () => {
            try {
                await signOut(auth);
                // ç™»å‡ºæˆåŠŸ, onAuthStateChanged æœƒè‡ªå‹•è™•ç†
            } catch (error) {
                console.error("ç™»å‡ºå¤±æ•—:", error);
                showError(`ç™»å‡ºå¤±æ•—ï¼š${error.message}`);
            }
        });

        // =================================================================
        // M-A-I-N A-P-P L-O-G-I-C
        // =================================================================

        // ç”¢ç”Ÿ SOAP ç­†è¨˜æŒ‰éˆ•
        generateButton.addEventListener('click', async () => {
            const patientInfo = patientInfoInput.value;
            const specialtyFocus = specialtyFocusSelect.value;
            const uptodateInfo = uptodateInfoInput.value.trim();
            const micromedexInfo = micromedexInfoInput.value.trim();
            const openevidenceInfo = openevidenceInfoInput.value.trim();

            if (!patientInfo.trim()) {
                showError("è«‹è¼¸å…¥ã€Œç—…æ‚£æ ¸å¿ƒè³‡æ–™ã€ã€‚");
                return;
            }

            // UI è¼‰å…¥ç‹€æ…‹
            progressBarContainer.style.display = 'block';
            placeholderDiv.classList.add('animate-pulse');
            generateButton.disabled = true;
            generateButton.classList.add('opacity-70', 'cursor-not-allowed');
            clearInputsButton.disabled = true;
            
            outputDiv.classList.add('hidden');
            placeholderDiv.classList.remove('hidden');
            infoBox.classList.add('hidden');
            sourcesContainer.classList.add('hidden');
            sourcesList.innerHTML = '';
            copyButton.disabled = true;

            try {
                // v16: å‘¼å« Firebase é›²ç«¯å‡½å¼
                const result = await generateSoapNote({ 
                    patientInfo, 
                    specialtyFocus, 
                    uptodateInfo, 
                    micromedexInfo, 
                    openevidenceInfo 
                });

                // result.data æ˜¯æˆ‘å€‘åœ¨ index.js ä¸­ return çš„ç‰©ä»¶
                const { soapNote, sources } = result.data; 

                // (v15.4 HTML è™•ç†é‚è¼¯ - ä¿æŒä¸è®Š)
                // 1. å…ˆ escape HTML, é¿å… XSS
                let safeHtml = soapNote
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;");
                
                // 2. è½‰æ› Markdown ç²—é«”
                safeHtml = safeHtml.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                
                // 3. æ”¾å…¥ <pre> ä¿æŒæ›è¡Œ
                outputDiv.innerHTML = `<pre>${safeHtml}</pre>`;
                
                outputDiv.classList.remove('hidden');
                placeholderDiv.classList.add('hidden');
                infoBox.classList.remove('hidden');

                // è™•ç†ä¾†æº
                let hasContent = false;
                const delimiter = '---GUIDELINES_USED---';
                let guidelinesText = '';

                if (safeHtml.includes(delimiter)) {
                    const parts = safeHtml.split(delimiter);
                    // (æˆ‘å€‘ä¸éœ€è¦è¦†è“‹ safeHtml, åªéœ€è¦å–å¾— guidelines)
                    guidelinesText = parts[1] || '';
                }
                
                // è™•ç† AI ç¸½çµçš„æŒ‡å¼•
                if (guidelinesText) {
                    const lines = guidelinesText.split('\n').filter(line => line.trim().length > 0);
                    lines.forEach(line => {
                        const li = document.createElement('li');
                        li.textContent = line.replace(/^\s*\*\s*/, '').replace(/&lt;/g, '<').replace(/&gt;/g, '>'); // è½‰å›
                        li.className = 'text-gray-800 font-semibold';
                        sourcesList.appendChild(li);
                    });
                    hasContent = true;
                }

                // è™•ç† Google æœå°‹çš„ä¾†æº
                if (sources && sources.length > 0) {
                    if (hasContent) {
                        const separator = document.createElement('li');
                        separator.innerHTML = '<hr class="my-2 border-gray-300">';
                        separator.setAttribute("aria-hidden", "true");
                        sourcesList.appendChild(separator);
                    }
                    sources.forEach(source => {
                        const li = document.createElement('li');
                        const a = document.createElement('a');
                        a.href = source.uri;
                        a.target = '_blank';
                        a.rel = 'noopener noreferrer';
                        a.className = 'text-blue-600 hover:underline';
                        a.textContent = source.title || 'ç›¸é—œåƒè€ƒæ–‡ä»¶';
                        li.appendChild(a);
                        sourcesList.appendChild(li);
                    });
                    hasContent = true;
                }
                
                if (hasContent) {
                    sourcesContainer.classList.remove('hidden');
                }
                
                copyButton.disabled = false;

            } catch (error) {
                console.error("å‘¼å«é›²ç«¯å‡½å¼å¤±æ•—:", error);
                // Firebase éŒ¯èª¤æœ‰ .message å±¬æ€§
                let errorMsg = error.message;
                // 'unauthenticated' æ˜¯æˆ‘å€‘åœ¨ index.js ä¸­è‡ªè¨‚çš„éŒ¯èª¤
                if (error.code === 'unauthenticated') {
                    errorMsg = "é©—è­‰å¤±æ•—ï¼Œè«‹é‡æ–°ç™»å…¥ã€‚";
                }
                // 'invalid-argument'
                if (error.code === 'invalid-argument') {
                    errorMsg = "æäº¤çš„è³‡æ–™æœ‰èª¤ï¼ˆå¯èƒ½ç¼ºå°‘ç—…æ‚£æ ¸å¿ƒè³‡æ–™ï¼‰ã€‚";
                }
                // AI å¼•æ“çš„éŒ¯èª¤
                if (error.message.includes("AI å¼•æ“éŒ¯èª¤:")) {
                    errorMsg = error.message;
                }
                showError(`ç„¡æ³•ç”¢ç”Ÿç­†è¨˜ï¼š${errorMsg}`);
                copyButton.disabled = true;
            } finally {
                // UI çµæŸè¼‰å…¥
                progressBarContainer.style.display = 'none';
                placeholderDiv.classList.remove('animate-pulse');
                generateButton.disabled = false;
                generateButton.classList.remove('opacity-70', 'cursor-not-allowed');
                clearInputsButton.disabled = false;
            }
        });

        // (v15.4 æ¸…é™¤/è¤‡è£½ åŠŸèƒ½ - ä¿æŒä¸è®Š)
        clearInputsButton.addEventListener('click', () => {
            patientInfoInput.value = '';
            specialtyFocusSelect.value = '';
            uptodateInfoInput.value = '';
            micromedexInfoInput.value = '';
            openevidenceInfoInput.value = '';
            
            outputDiv.classList.add('hidden');
            placeholderDiv.classList.remove('hidden');
            infoBox.classList.add('hidden');
            sourcesContainer.classList.add('hidden');
            sourcesList.innerHTML = '';
            copyButton.disabled = true;
        });

        copyButton.addEventListener('click', () => {
            const textToCopy = outputDiv.textContent || outputDiv.innerText;
            if (!textToCopy) {
                showError("æ²’æœ‰å…§å®¹å¯ä»¥è¤‡è£½ã€‚");
                return;
            }
            const textArea = document.createElement("textarea");
            textArea.value = textToCopy;
            textArea.style.position = "fixed";
            textArea.style.top = "0";
            textArea.style.left = "0";
            textArea.style.opacity = "0";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    copyButton.textContent = "å·²è¤‡è£½!";
                    setTimeout(() => { copyButton.textContent = "ä¸€éµè¤‡è£½"; }, 2000);
                } else {
                    showError("è¤‡è£½å¤±æ•—ã€‚ç€è¦½å™¨å¯èƒ½ä¸æ”¯æ´æ­¤åŠŸèƒ½ã€‚");
                }
            } catch (err) {
                console.error("è¤‡è£½å¤±æ•—: ", err);
                showError(`è¤‡è£½å¤±æ•—ï¼š${err.message}`);
            }
            document.body.removeChild(textArea);
        });

    </script>

    <div class="container mx-auto max-w-6xl p-4 py-8">
        <section id="loginSection" class="bg-white p-6 rounded-xl shadow-xl mb-6 border-l-4 border-blue-500 text-center">
            <h2 class="text-2xl font-semibold mb-4 text-gray-700">1. è«‹å…ˆç™»å…¥</h2>
            <p class="text-gray-600 mb-6">æœ¬å·¥å…·éœ€è¦ç™»å…¥ Google å¸³è™Ÿæ‰èƒ½ä½¿ç”¨é›²ç«¯ AI æœå‹™ã€‚</p>
            <button id="signInButton" class="google-btn">
                <svg viewBox="0 0 24 24">
                    <path fill="#4285F4" d="M21.35 12.22c0-.78-.07-1.53-.2-2.27H12v4.27h5.27c-.24 1.48-.96 2.76-2.07 3.6v2.76h3.57c2.08-1.92 3.28-4.7 3.28-7.96z"/>
                    <path fill="#34A853" d="M12 21.6c2.56 0 4.7-.85 6.27-2.31l-3.57-2.76c-.85.57-1.94.9-3.1.9-2.38 0-4.38-1.6-5.1-3.75H3.26v2.85C4.8 19.8 8.14 21.6 12 21.6z"/>
                    <path fill="#FBBC05" d="M6.9 12.8c-.14-.42-.22-.87-.22-1.33s.08-.91.22-1.33V7.27H3.26C2.6 8.5 2.2 9.94 2.2 11.47s.4 2.97 1.06 4.2l3.64-2.87z"/>
                    <path fill="#EA4335" d="M12 6.73c1.38 0 2.63.48 3.6 1.4l3.1-3.1C16.7.9 14.56 0 12 0 8.14 0 4.8 1.8 3.26 4.67l3.64 2.85c.72-2.16 2.72-3.75 5.1-3.75z"/>
                </svg>
                ä½¿ç”¨ Google å¸³è™Ÿç™»å…¥
            </button>
            <div id="authStatus" class="mt-4 text-gray-500 text-sm">ç‹€æ…‹ï¼šå°šæœªç™»å…¥</div>
            <button id="signOutButton" class="hidden mt-4 bg-red-500 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-300">
                ç™»å‡º
            </button>
        </section>

        <main id="mainContent" class="grid grid-cols-1 md:grid-cols-2 gap-6" style="display: none;">

            <div class="bg-white p-6 rounded-xl shadow-xl flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold text-gray-700 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-3 text-blue-500"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
                        2. è¼¸å…¥ç—…æ‚£è³‡æ–™
                    </h2>
                    <button id="clearInputsButton" class="text-sm text-slate-500 hover:text-red-600 font-medium py-1 px-2 rounded-lg hover:bg-red-50 transition-all duration-200 hover:scale-105 hover:shadow-md flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 mr-1"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                        ä¸€éµæ¸…é™¤
                    </button>
                </div>

                <div class="mb-4">
                    <label for="specialtyFocus" class="block text-sm font-medium text-gray-600 mb-2">
                        å°ˆç§‘ç„¦é» (é¸å¡«)
                    </label>
                    <select id="specialtyFocus" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                        <option value="" selected>ç„¡ç‰¹å®šç§‘åˆ¥ (ç¶œåˆè©•ä¼°)</option>
                        <option value="å¿ƒè‡Ÿå…§ç§‘">å¿ƒè‡Ÿå…§ç§‘ (Cardiology)</option>
                        <option value="èƒ¸è…”å…§ç§‘">èƒ¸è…”å…§ç§‘ (Pulmonology)</option>
                        </select>
                </div>
                
                <div class="mb-4 p-4 bg-yellow-50 border border-yellow-300 text-yellow-800 rounded-lg">
                    <h4 class="font-bold text-sm flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 mr-2 text-yellow-600"><path d="M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                        é‡è¦è­¦å‘Š
                    </h4>
                    <p class="text-sm mt-1">
                        åš´ç¦è¼¸å…¥ä»»ä½•å¯è­˜åˆ¥ç—…æ‚£èº«ä»½çš„è³‡è¨Š (å¦‚å§“åã€ç—…æ­·è™Ÿ)ã€‚è«‹åœ¨è²¼ä¸Šè³‡æ–™å‰ï¼Œè‡ªè¡Œå®Œæˆå»è­˜åˆ¥åŒ–ã€‚æ‚¨æäº¤çš„åŒ¿åè³‡æ–™å°‡è¢«å‚³é€è‡³ AI ä¼ºæœå™¨é€²è¡Œåˆ†æã€‚
                    </p>
                </div>

                <div class="mb-4">
                    <label for="patientInfo" class="block text-sm font-medium text-gray-600 mb-2">
                        ç—…æ‚£æ ¸å¿ƒè³‡æ–™ (å¿…å¡«)
                    </label>
                    <textarea id="patientInfo" rows="10" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="è«‹è²¼å…¥ã€Œå»è­˜åˆ¥åŒ–ã€å¾Œçš„ç—…æ‚£è³‡è¨Š..."></textarea>
                </div>

                <div class="mb-4">
                    <label for="uptodateInfo" class="block text-sm font-medium text-gray-600 mb-2">
                        æ•´åˆ UpToDate (é¸å¡«)
                    </label>
                    <textarea id="uptodateInfo" rows="4" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="è²¼ä¸Š UpToDate çš„é‡é»..."></textarea>
                </div>
                <div class="mb-4">
                    <label for="micromedexInfo" class="block text-sm font-medium text-gray-600 mb-2">
                        æ•´åˆ Micromedex (é¸å¡«)
                    </label>
                    <textarea id="micromedexInfo" rows="4" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="è²¼ä¸Š Micromedex çš„é‡é»..."></textarea>
                </div>
                <div class="mb-4">
                    <label for="openevidenceInfo" class="block text-sm font-medium text-gray-600 mb-2">
                        æ•´åˆ OpenEvidence (é¸å¡«)
                    </label>
                    <textarea id="openevidenceInfo" rows="4" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="è²¼ä¸Š OpenEvidence çš„é‡é»..."></textarea>
                </div>

                <div class="mt-auto pt-4">
                    <button id="generateButton" class="w-full bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-300 ease-in-out hover:scale-105 flex items-center justify-center">
                        ğŸš€ å•Ÿå‹•é›²ç«¯ AI åˆ†æ
                    </button>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-xl">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold text-gray-700 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-3 text-blue-500"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><line x1="12" y1="11" x2="12" y2="17"></line><line x1="9" y1="14" x2="15" y2="14"></line></svg>
                        3. ç”¢ç”Ÿçš„ç­†è¨˜è‰ç¨¿
                    </h2>
                    <button id="copyButton" class="bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-transform duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        ä¸€éµè¤‡è£½
                    </button>
                </div>
                
                <div id="progressBarContainer">
                    <div class="progress-bar"></div>
                </div>

                <div id="placeholder" class="text-center text-gray-500 p-8 border-2 border-dashed border-gray-300 rounded-lg transition-opacity duration-300">
                    <p class="font-semibold">AI å°‡è‡ªå‹•åŸ·è¡Œä»¥ä¸‹ä»»å‹™ï¼š</p>
                    <ul class="list-disc list-inside text-left mt-2 text-sm">
                        <li>åˆ†æç—…æ­·ä¸¦è­˜åˆ¥ä¸»è¦å•é¡Œã€‚</li>
                        <li>å³æ™‚ä¸Šç¶²æœå°‹æœ€æ–°çš„åœ‹éš›æŒ‡å¼• (GINA, GOLD...)ã€‚</li>
                        <li>è©•ä¼° DDI èˆ‡é‡è¤‡ç”¨è—¥ã€‚</li>
                        <li>(v15.2) æ•´åˆæ‚¨æä¾›çš„è³‡æ–™åº«é‡é»ä¸¦è¨»æ˜ä¾†æºã€‚</li>
                    </ul>
                    <p class="text-sm mt-4">æ‰€æœ‰å…§å®¹å‡éœ€ç”±å°ˆæ¥­è—¥å¸«æœ€çµ‚å¯©æ ¸ã€‚</p>
                </div>

                <div id="output" class="hidden prose max-w-none prose-pre:whitespace-pre-wrap bg-gray-50 p-4 rounded-lg border border-gray-200" style="min-height: 200px;"></div>

                <div id="infoBox" class="hidden mt-4 bg-blue-50 border border-blue-200 text-blue-800 p-4 rounded-lg">
                    <h4 class="font-bold text-sm">AI è¼”åŠ©èªªæ˜ (v16.0)ï¼š</h4>
                    <ul class="list-disc list-inside text-sm mt-1">
                        <li>**æœ€æ–°æŒ‡å¼•ï¼š** AI å·²è¢«æŒ‡ç¤ºåœ¨ã€ŒAssessmentã€ä¸­**å¿…é ˆè¨»æ˜**æ‰€åƒè€ƒæŒ‡å¼•çš„**ã€Œå¯¦éš›å¹´ä»½ã€**èˆ‡**ã€ŒåŸæ–‡å¥å­ã€**ã€‚</li>
                        <li>**DDI åˆ†æï¼š** è—¥ç‰©äº¤äº’ä½œç”¨ (DDI) è©•ä¼°å·²ä½¿ç”¨ Gemini æ·±åº¦ç ”ç©¶åŠŸèƒ½å®Œæˆã€‚</li>
                        <li>**è³‡æ–™åº«æ•´åˆï¼š** AI å·²æ•´åˆæ‚¨æä¾›çš„ UpToDate/Micromedex/OpenEvidence è³‡è¨Šã€‚</li>
                        <li>**å°ˆæ¥­å¯©æ ¸ï¼š** å…§å®¹åƒ…ä¾›åƒè€ƒï¼Œè«‹å‹™å¿…ç”±æ‚¨é€²è¡Œæœ€çµ‚çš„å°ˆæ¥­å¯©æ ¸èˆ‡ä¿®æ”¹ã€‚</li>
                    </ul>
                </div>

                <div id="sourcesContainer" class="hidden mt-6">
                    <h3 id="sourcesTitle" class="text-lg font-semibold text-gray-600 mb-2">å¼•ç”¨çš„æŒ‡å¼•èˆ‡åƒè€ƒä¾†æºï¼š</h3>
                    <ul id="sourcesList" class="list-none list-inside text-sm space-y-1"></ul>
                </div>
            </div>
        </main>

        <footer class="text-center py-6 mt-8 border-t border-gray-200">
            <p class="text-sm text-gray-500">
                æœ¬å·¥å…·åŸå§‹ç¢¼èˆ‡æ›´æ–°ç‰ˆå¯æ–¼ 
                <a href="https://github.com/Almightyhao/SOAP-writter" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">
                    https://github.com/Almightyhao/SOAP-writter
                </a>
                 æŸ¥æ‰¾
            </p>
        </footer>

    </div>

    <div id="errorModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center hidden z-50">
        <div class="relative mx-auto p-5 border w-full max-w-md shadow-lg rounded-xl bg-white">
            <div class="mt-3 text-center">
                <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100">
                    <svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </div>
                <h3 class="text-lg leading-6 font-medium text-gray-900 mt-2">ç™¼ç”ŸéŒ¯èª¤</h3>
                <div class="mt-2 px-7 py-3">
                    <p id="errorMessage" class="text-sm text-gray-500">ç„¡æ³•ç”¢ç”Ÿç­†è¨˜ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚</p>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="closeModalButton" class="px-4 py-2 bg-red-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-300">é—œé–‰</button>
                </div>
            </div>
        </div>
    </div>

</body>
</html>